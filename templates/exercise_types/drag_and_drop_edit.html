{% extends "edit_exercise.html" %}

{% block exercise_content %}
<div class="mb-4">
    <h4>Glisser-déposer</h4>
    <p class="text-muted">Modifiez les éléments à faire glisser et les zones de dépôt.</p>
    
    <div class="row">
        <div class="col-md-6">
            <h5>Éléments à glisser</h5>
            <div id="drag_items_container">
                {% if content and content.draggable_items %}
                    {% for item in content.draggable_items %}
                        <div class="input-group mb-2">
                            <input type="text" name="drag_items[]" class="form-control" value="{{ item }}" required>
                            <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="input-group mb-2">
                        <input type="text" name="drag_items[]" class="form-control" placeholder="Entrez un élément à glisser" required>
                        <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addDragItem()">
                <i class="bi bi-plus-circle"></i> Ajouter un élément
            </button>
        </div>
        
        <div class="col-md-6">
            <h5>Zones de dépôt</h5>
            <div id="drop_zones_container">
                {% if content and content.drop_zones %}
                    {% for zone in content.drop_zones %}
                        <div class="input-group mb-2">
                            <input type="text" name="drop_zones[]" class="form-control" value="{{ zone }}" required>
                            <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="input-group mb-2">
                        <input type="text" name="drop_zones[]" class="form-control" placeholder="Entrez une zone de dépôt" required>
                        <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addDropZone()">
                <i class="bi bi-plus-circle"></i> Ajouter une zone
            </button>
        </div>
    </div>
    
    <div class="mt-4">
        <h5>Ordre correct</h5>
        <p class="text-muted">Spécifiez l'ordre correct des éléments (numérotation à partir de 0).</p>
        <div id="correct_order_container">
            {% set order_str = content.correct_order|join(',') if content and content.correct_order else '' %}
            <input type="text" name="correct_order" class="form-control" value="{{ order_str }}" placeholder="Ex: 1,0,2,3 (ordre des éléments dans les zones)" required>
        </div>
    </div>
</div>

<script>
// Fonctions pour Glisser-déposer (édition)
function addDragItem() {
    const container = document.getElementById('drag_items_container');
    const newItemDiv = document.createElement('div');
    newItemDiv.className = 'input-group mb-2';
    newItemDiv.innerHTML = `
        <input type="text" name="drag_items[]" class="form-control" placeholder="Entrez un élément à glisser" required>
        <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
            <i class="bi bi-trash"></i>
        </button>
    `;
    container.appendChild(newItemDiv);
}

function addDropZone() {
    const container = document.getElementById('drop_zones_container');
    const newZoneDiv = document.createElement('div');
    newZoneDiv.className = 'input-group mb-2';
    newZoneDiv.innerHTML = `
        <input type="text" name="drop_zones[]" class="form-control" placeholder="Entrez une zone de dépôt" required>
        <button type="button" class="btn btn-danger" onclick="this.closest('.input-group').remove()">
            <i class="bi bi-trash"></i>
        </button>
    `;
    container.appendChild(newZoneDiv);
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Template drag-and-drop edit chargé et prêt');
});
</script>
{% endblock %}
