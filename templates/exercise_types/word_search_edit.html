{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>{% if exercise %}Modifier{% else %}Créer{% endif %} un exercice de mots mêlés</h2>

    <form method="POST" class="mt-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <div class="mb-3">
            <label for="title" class="form-label">Titre</label>
            <input type="text" class="form-control" id="title" name="title" value="{{ exercise.title if exercise else '' }}" required>
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="3" required>{{ exercise.description if exercise else '' }}</textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Mots à trouver</label>
            <div id="words-container">
                {% if content and content.words %}
                    {% for word in content.words %}
                        <div class="input-group mb-2 word-input">
                            <input type="text" class="form-control" name="words[]" value="{{ word }}" required>
                            <button type="button" class="btn btn-outline-danger remove-word">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="input-group mb-2 word-input">
                        <input type="text" class="form-control" name="words[]" required>
                        <button type="button" class="btn btn-outline-danger remove-word">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-outline-primary" id="add-word">
                <i class="fas fa-plus"></i> Ajouter un mot
            </button>
        </div>

        <div class="mb-3">
            <label for="grid-size" class="form-label">Taille de la grille</label>
            <select class="form-select" id="grid-size" name="grid_size" required>
                {% for size in range(8, 21) %}
                    <option value="{{ size }}" {% if content and content.grid and content.grid|length == size %}selected{% endif %}>
                        {{ size }}x{{ size }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label for="difficulty" class="form-label">Difficulté</label>
            <select class="form-select" id="difficulty" name="difficulty" required>
                <option value="easy" {% if exercise and exercise.difficulty == 'easy' %}selected{% endif %}>Facile</option>
                <option value="medium" {% if exercise and exercise.difficulty == 'medium' %}selected{% endif %}>Moyen</option>
                <option value="hard" {% if exercise and exercise.difficulty == 'hard' %}selected{% endif %}>Difficile</option>
            </select>
        </div>

        {% if courses %}
        <div class="mb-3">
            <label for="course" class="form-label">Cours</label>
            <select class="form-select" id="course" name="course_id">
                <option value="">Aucun cours</option>
                {% for course in courses %}
                    <option value="{{ course.id }}" {% if exercise and exercise.course_id == course.id %}selected{% endif %}>
                        {{ course.title }}
                    </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Enregistrer
        </button>
        <a href="{{ url_for('exercise.exercise_library') }}" class="btn btn-secondary">
            <i class="fas fa-times"></i> Annuler
        </a>
    </form>
</div>

<script>
// Solution simple et directe pour le bouton "Ajouter un mot"
function addWordField() {
    console.log('addWordField called'); // Debug
    const container = document.getElementById('words-container');
    if (!container) {
        console.error('Container not found');
        return;
    }
    
    const newDiv = document.createElement('div');
    newDiv.className = 'input-group mb-2 word-input';
    newDiv.innerHTML = `
        <input type="text" class="form-control" name="words[]" required placeholder="Entrez un mot">
        <button type="button" class="btn btn-outline-danger" onclick="removeWordField(this)">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    container.appendChild(newDiv);
    console.log('New word field added'); // Debug
    
    // Focus sur le nouveau champ
    const newInput = newDiv.querySelector('input');
    if (newInput) {
        newInput.focus();
    }
}

function removeWordField(button) {
    const container = document.getElementById('words-container');
    const wordInput = button.closest('.word-input');
    
    if (container && wordInput && container.children.length > 1) {
        wordInput.remove();
        console.log('Word field removed'); // Debug
    }
}

// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    console.log('Word search editor loaded'); // Debug
    const addButton = document.getElementById('add-word');
    const container = document.getElementById('words-container');
    
    console.log('Add button:', addButton); // Debug
    console.log('Container:', container); // Debug
    
    if (addButton) {
        addButton.onclick = function(e) {
            e.preventDefault();
            console.log('Add button clicked!'); // Debug
            addWordField();
        };
        console.log('Add button event attached'); // Debug
    } else {
        console.error('Add button not found!');
    }
});
</script>
{% endblock %}
