{% extends "base.html" %}

{% block title %}Paiement de votre Abonnement{% endblock %}

{% block head %}
<style>
    .subscription-payment {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 40px 0;
    }
    
    .payment-card {
        background: white;
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }
    
    .payment-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .payment-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 2rem;
        color: white;
    }
    
    .amount-display {
        background: linear-gradient(135deg, #007bff 0%, #6610f2 100%);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
    }
    
    .amount-value {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .payment-method {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
    }
    
    .payment-method:hover {
        border-color: #007bff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .payment-method.selected {
        border-color: #007bff;
        background: #f8f9ff;
    }
    
    .payment-method-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: #007bff;
    }
    
    .payment-method-name {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 10px;
    }
    
    .payment-method-desc {
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    .payment-form {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-control {
        border-radius: 10px;
        border: 1px solid #dee2e6;
        padding: 12px 15px;
        font-size: 1rem;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
    }
    
    .btn-pay {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        color: white;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: 600;
        width: 100%;
        transition: all 0.3s ease;
    }
    
    .btn-pay:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(40,167,69,0.3);
        color: white;
    }
    
    .security-info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .security-info h6 {
        color: #1565c0;
        margin-bottom: 10px;
    }
    
    .security-info p {
        color: #1976d2;
        margin: 0;
        font-size: 0.9rem;
    }
    
    .subscription-details {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #dee2e6;
    }
    
    .detail-row:last-child {
        border-bottom: none;
        font-weight: bold;
        font-size: 1.1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="subscription-payment">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- En-tête -->
                <div class="payment-card">
                    <div class="payment-header">
                        <div class="payment-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <h1>Paiement de votre Abonnement</h1>
                        <p class="text-muted">Finalisez votre inscription en effectuant le paiement de votre cotisation</p>
                    </div>

                    <!-- Montant -->
                    <div class="amount-display">
                        <div class="amount-value">{{ amount }}€</div>
                        <div>Abonnement {{ subscription_type|title }}</div>
                    </div>

                    <!-- Détails de l'abonnement -->
                    <div class="subscription-details">
                        <h5><i class="fas fa-receipt me-2"></i>Détails de votre abonnement</h5>
                        <div class="detail-row">
                            <span>Type d'abonnement :</span>
                            <span>{{ subscription_type|title }}</span>
                        </div>
                        <div class="detail-row">
                            <span>Durée :</span>
                            <span>1 an</span>
                        </div>
                        <div class="detail-row">
                            <span>Utilisateur :</span>
                            <span>{{ user.name }} ({{ user.email }})</span>
                        </div>
                        <div class="detail-row">
                            <span>Total à payer :</span>
                            <span>{{ amount }}€</span>
                        </div>
                    </div>

                    <!-- Informations de sécurité -->
                    <div class="security-info">
                        <h6><i class="fas fa-shield-alt me-2"></i>Paiement sécurisé</h6>
                        <p>Ce formulaire est temporaire. Dans la version finale, le paiement sera traité via une plateforme sécurisée (Stripe, PayPal, etc.). Pour les tests, vous pouvez simuler un paiement.</p>
                    </div>

                    <!-- Méthodes de paiement (simulation) -->
                    <div class="payment-methods">
                        <div class="payment-method selected" data-method="card">
                            <div class="payment-method-icon">
                                <i class="fas fa-credit-card"></i>
                            </div>
                            <div class="payment-method-name">Carte bancaire</div>
                            <div class="payment-method-desc">Visa, Mastercard, American Express</div>
                        </div>
                        
                        <div class="payment-method" data-method="paypal">
                            <div class="payment-method-icon">
                                <i class="fab fa-paypal"></i>
                            </div>
                            <div class="payment-method-name">PayPal</div>
                            <div class="payment-method-desc">Paiement via votre compte PayPal</div>
                        </div>
                        
                        <div class="payment-method" data-method="bank">
                            <div class="payment-method-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="payment-method-name">Virement bancaire</div>
                            <div class="payment-method-desc">Paiement par virement SEPA</div>
                        </div>
                    </div>

                    <!-- Formulaire de paiement simulé -->
                    <form method="POST" action="{{ url_for('process_payment') }}" class="payment-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="hidden" name="amount" value="{{ amount }}">
                        <input type="hidden" name="subscription_type" value="{{ subscription_type }}">
                        
                        <h5 class="mb-3"><i class="fas fa-credit-card me-2"></i>Informations de paiement</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="card_number" class="form-label">Numéro de carte</label>
                                    <input type="text" class="form-control" id="card_number" name="card_number" 
                                           placeholder="1234 5678 9012 3456" value="4242 4242 4242 4242">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="card_name" class="form-label">Nom sur la carte</label>
                                    <input type="text" class="form-control" id="card_name" name="card_name" 
                                           placeholder="Nom Prénom" value="{{ user.name }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="expiry" class="form-label">Date d'expiration</label>
                                    <input type="text" class="form-control" id="expiry" name="expiry" 
                                           placeholder="MM/AA" value="12/25">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="cvv" class="form-label">Code CVV</label>
                                    <input type="text" class="form-control" id="cvv" name="cvv" 
                                           placeholder="123" value="123">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                            <label class="form-check-label" for="terms">
                                J'accepte les <a href="#" target="_blank">conditions générales</a> et la <a href="#" target="_blank">politique de confidentialité</a>
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-pay">
                            <i class="fas fa-lock me-2"></i>Payer {{ amount }}€ en sécurité
                        </button>
                    </form>

                    <!-- Actions alternatives -->
                    <div class="text-center mt-4">
                        <a href="{{ url_for('subscription_status') }}" class="btn btn-outline-secondary me-3">
                            <i class="fas fa-arrow-left me-2"></i>Retour
                        </a>
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-home me-2"></i>Accueil
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Gestion de la sélection des méthodes de paiement
document.addEventListener('DOMContentLoaded', function() {
    const paymentMethods = document.querySelectorAll('.payment-method');
    
    paymentMethods.forEach(method => {
        method.addEventListener('click', function() {
            paymentMethods.forEach(m => m.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
    
    // Formatage automatique du numéro de carte
    const cardNumberInput = document.getElementById('card_number');
    if (cardNumberInput) {
        cardNumberInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });
    }
    
    // Formatage de la date d'expiration
    const expiryInput = document.getElementById('expiry');
    if (expiryInput) {
        expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });
    }
});
</script>
{% endblock %}
